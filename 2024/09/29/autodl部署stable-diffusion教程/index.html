<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><title>手把手教学autodl部署stable diffusion webui | Orion Blog</title><meta name="author" content="Orion"><meta name="description" content="Here's Orion"><meta name="keywords" content="技术博客,Orion,BUPT北京邮电大学,本科生,人工智能,AI算法工程师,机器学习,深度学习,计算机视觉,自然语言处理,NLP,CV,大模型"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0"><link rel="icon" href="https://testingcf.jsdelivr.net/gh/nanzhi84/blog-images/202409190134514.png"><link rel="preload" as="image" href="https://testingcf.jsdelivr.net/gh/nanzhi84/blog-images/202409181543316.png"><link rel="preconnect" href="https://s4.zstatic.net"><script src="https://s4.zstatic.net/ajax/libs/vue/3.3.7/vue.global.prod.min.js"></script><link rel="stylesheet" href="https://s4.zstatic.net/ajax/libs/font-awesome/6.4.2/css/all.min.css" media="only x" onload='this.onload=null,this.media="all"'><link rel="preconnect" href="https://fonts.googleapis.cn"><link rel="preconnect" href="https://fonts.gstatic.cn" crossorigin><link rel="stylesheet" href="https://fonts.googleapis.cn/css2?family=Fira+Code:wght@400;500;600;700&family=Lexend:wght@400;500;600;700;800;900&family=Noto+Sans+SC:wght@400;500;600;700;800;900&display=swap" media="only x" onload='this.onload=null,this.media="all"'><script>const mixins={}</script><script src="https://s4.zstatic.net/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script><script src="https://s4.zstatic.net/ajax/libs/highlightjs-line-numbers.js/2.8.0/highlightjs-line-numbers.min.js"></script><link rel="stylesheet" href="https://s4.zstatic.net/ajax/libs/highlight.js/11.9.0/styles/github.min.css"><script src="/js/lib/highlight.js"></script><script src="https://s4.zstatic.net/ajax/libs/KaTeX/0.16.9/katex.min.js"></script><script src="https://s4.zstatic.net/ajax/libs/KaTeX/0.16.9/contrib/auto-render.min.js"></script><link rel="stylesheet" href="https://s4.zstatic.net/ajax/libs/KaTeX/0.16.9/katex.min.css"><script src="/js/lib/math.js"></script><script src="/js/lib/preview.js"></script><script src="https://s4.zstatic.net/ajax/libs/waline/2.15.8/waline.min.js"></script><link rel="stylesheet" href="https://s4.zstatic.net/ajax/libs/waline/2.15.8/waline.min.css"><link rel="stylesheet" href="https://s4.zstatic.net/ajax/libs/waline/2.15.8/waline-meta.min.css"><script src="https://cdn.staticfile.org/animejs/3.2.1/anime.min.js"></script><link rel="stylesheet" href="/css/main.css"><link rel="preconnect" href="https://static-argvchs.netlify.app"><meta name="generator" content="Hexo 7.3.0"><style>mjx-container[jax=SVG]{direction:ltr}mjx-container[jax=SVG]>svg{overflow:visible}mjx-container[jax=SVG][display=true]{display:block;text-align:center;margin:1em 0}mjx-container[jax=SVG][justify=left]{text-align:left}mjx-container[jax=SVG][justify=right]{text-align:right}g[data-mml-node=merror]>g{fill:red;stroke:red}g[data-mml-node=merror]>rect[data-background]{fill:yellow;stroke:none}g[data-mml-node=mtable]>line[data-line]{stroke-width:70px;fill:none}g[data-mml-node=mtable]>rect[data-frame]{stroke-width:70px;fill:none}g[data-mml-node=mtable]>.mjx-dashed{stroke-dasharray:140}g[data-mml-node=mtable]>.mjx-dotted{stroke-linecap:round;stroke-dasharray:0,140}g[data-mml-node=mtable]>svg{overflow:visible}[jax=SVG] mjx-tool{display:inline-block;position:relative;width:0;height:0}[jax=SVG] mjx-tool>mjx-tip{position:absolute;top:0;left:0}mjx-tool>mjx-tip{display:inline-block;padding:.2em;border:1px solid #888;font-size:70%;background-color:#f8f8f8;color:#000;box-shadow:2px 2px 5px #aaa}g[data-mml-node=maction][data-toggle]{cursor:pointer}mjx-status{display:block;position:fixed;left:1em;bottom:1em;min-width:25%;padding:.2em .4em;border:1px solid #888;font-size:90%;background-color:#f8f8f8;color:#000}foreignObject[data-mjx-xml]{font-family:initial;line-height:normal;overflow:visible}.MathJax path{stroke-width:3}mjx-container[display=true]{overflow:auto hidden}mjx-container[display=true]+br{display:none}</style></head><body><div id="layout"><transition name="fade"><div id="loading" v-show="loading"><div id="loading-circle"><h2>LOADING</h2><p>加载过慢请开启缓存 浏览器默认开启</p><img src="https://testingcf.jsdelivr.net/gh/nanzhi84/blog-images/202409201808995.gif"></div></div></transition><div id="menu" :class="{ hidden: hiddenMenu, 'menu-color': menuColor}"><nav id="desktop-menu"><a class="title" href="/"><span>ORION BLOG</span></a><a href="/"><i class="fa-solid fa-house fa-fw"></i> <span>&ensp;Home</span></a><a href="/about"><i class="fa-solid fa-id-card fa-fw"></i> <span>&ensp;About</span></a><a href="/archives"><i class="fa-solid fa-box-archive fa-fw"></i> <span>&ensp;Archives</span></a><a href="/categories"><i class="fa-solid fa-bookmark fa-fw"></i> <span>&ensp;Categories</span></a><a href="/tags"><i class="fa-solid fa-tags fa-fw"></i> <span>&ensp;Tags</span></a></nav><nav id="mobile-menu"><div class="title" @click="showMenuItems = !showMenuItems"><i class="fa-solid fa-bars fa-fw"></i> <span>&emsp;ORION BLOG</span></div><transition name="slide"><div class="items" v-show="showMenuItems"><a href="/"><div class="item"><div style="min-width:20px;max-width:50px;width:10%"><i class="fa-solid fa-house fa-fw"></i></div><div style="min-width:100px;max-width:150%;width:20%">Home</div></div></a><a href="/about"><div class="item"><div style="min-width:20px;max-width:50px;width:10%"><i class="fa-solid fa-id-card fa-fw"></i></div><div style="min-width:100px;max-width:150%;width:20%">About</div></div></a><a href="/archives"><div class="item"><div style="min-width:20px;max-width:50px;width:10%"><i class="fa-solid fa-box-archive fa-fw"></i></div><div style="min-width:100px;max-width:150%;width:20%">Archives</div></div></a><a href="/categories"><div class="item"><div style="min-width:20px;max-width:50px;width:10%"><i class="fa-solid fa-bookmark fa-fw"></i></div><div style="min-width:100px;max-width:150%;width:20%">Categories</div></div></a><a href="/tags"><div class="item"><div style="min-width:20px;max-width:50px;width:10%"><i class="fa-solid fa-tags fa-fw"></i></div><div style="min-width:100px;max-width:150%;width:20%">Tags</div></div></a></div></transition></nav></div><transition name="fade"><div id="menu-curtain" @click="showMenuItems = !showMenuItems" v-show="showMenuItems"></div></transition><div id="main" :class="loading ? 'into-enter-from': 'into-enter-active'"><div class="article"><div><h1>手把手教学autodl部署stable diffusion webui</h1></div><div class="info"><span class="date"><span class="icon"><i class="fa-solid fa-calendar fa-fw"></i></span> 2024/9/29</span><span class="category"><a href="/categories/%E6%95%99%E7%A8%8B/"><span class="icon"><i class="fa-solid fa-bookmark fa-fw"></i></span> 教程</a></span><span class="tags"><span class="icon"><i class="fa-solid fa-tags fa-fw"></i></span> <span class="tag"><a href="/tags/stable-diffusion/" style="color:#00a596">stable-diffusion</a></span> <span class="tag"><a href="/tags/%E6%95%99%E7%A8%8B/" style="color:#00bcd4">教程</a></span></span></div><div class="content" v-pre><h3 id="准备工作">准备工作</h3><ol type="1"><li><p>进入<a target="_blank" rel="noopener" href="https://www.autodl.com/login">AutoDL算力云 | 弹性、好用、省钱。租GPU就上AutoDL</a>官网，注册一个账号。</p></li><li><p>选择显卡，和是否需要扩容，我这里选择北京B区4090，并且先选不扩容。</p><p><img src="https://testingcf.jsdelivr.net/gh/nanzhi84/blog-images/202409291226232.png" alt="image-20240929122636123"></p></li></ol><span id="more"></span><ol start="3" type="1"><li><p>镜像按照下面选即可</p><p><img src="https://testingcf.jsdelivr.net/gh/nanzhi84/blog-images/202409291253954.png" alt="image-20240929125339904"></p></li><li><p>创建好之后最好到控制台重新选择一下无卡模式开机创建环境，避免扣多钱</p><p><img src="https://testingcf.jsdelivr.net/gh/nanzhi84/blog-images/202409291234805.png" alt="image-20240929123409708"></p></li><li><p>然后打开右边的jupyter lab</p><p><img src="https://testingcf.jsdelivr.net/gh/nanzhi84/blog-images/202409291235721.png" alt="image-20240929123518681"></p></li><li><p>左边点进autodl-tmp文件夹后打开终端</p><p><img src="https://testingcf.jsdelivr.net/gh/nanzhi84/blog-images/202409291236770.png" alt="image-20240929123626675"></p></li><li><p>进入这个页面后就可以开始安装了</p><p><img src="https://testingcf.jsdelivr.net/gh/nanzhi84/blog-images/202409291237568.png" alt="image-20240929123705488"></p></li></ol><h3 id="配置环境">配置环境</h3><ol type="1"><li><p>在终端里先输入下面这条命令开启autodl的学术资源加速</p><pre class="bash"><code>source /etc/network_turbo</code></pre></li><li><p>然后输入以下命令拉取仓库</p><pre class="bash"><code> git clone https://github.com/AUTOMATIC1111/stable-diffusion-webui.git</code></pre></li><li><p>先安装这两个库，不然报错</p><pre class="bash"><code>ln -s libtcmalloc.so.4 libtcmalloc.so 
// 建立软连接，不然显示
// E: Unable to locate package libgoogle-perftools4
// E: Unable to locate package libtcmalloc-minimal4
sudo apt-get update //更新
sudo apt-get install libgoogle-perftools4 libtcmalloc-minimal4 -y</code></pre></li><li><p>输入下面命令安装依赖项，作者已经帮忙全部打包好了不需要自己手动安装</p><pre class="bash"><code>cd stable-diffusion-webui
bash webui.sh -f // 有卡开机用这个
bash webui.sh -f --skip-torch-cuda-test // 无卡开机用这个跳过gpu检测</code></pre></li><li><p>成功了发现它给了本地url链接http://127.0.0.1:7860，但是我们在云端部署无法直接访问，还需要将端口映射本地</p><p><img src="https://testingcf.jsdelivr.net/gh/nanzhi84/blog-images/202409291358136.png" alt="image-20240929135832076"></p></li><li><p>打开控制台会发现有登录指令和密码</p><p><img src="https://testingcf.jsdelivr.net/gh/nanzhi84/blog-images/202409291400768.png" alt="image-20240929140040722"></p></li><li><p>复制登录指令并且将前面的url按下面的格式复制到你本地的cmd中运行</p><pre><code>// ssh -p 51732 root@123456.com 假设这是你的登录指令
ssh -L 7860:127.0.0.1:7860 -p 51732 root@123456.com // 按照这样运行</code></pre><p>然后如图选择yes再输入密码，注意这里你打上去密码也不会显示，是正常现象</p><p><img src="https://testingcf.jsdelivr.net/gh/nanzhi84/blog-images/202409291404874.png" alt="image-20240929140452796"></p></li><li><p>如图进入到这个页面就是成功了，这时候你可以打开前面的http://127.0.0.1:7860</p><p><img src="https://testingcf.jsdelivr.net/gh/nanzhi84/blog-images/202409291405667.png" alt="image-20240929140549584"></p><p><img src="https://testingcf.jsdelivr.net/gh/nanzhi84/blog-images/202409291406622.png" alt="image-20240929140618944"></p></li><li><p>进入到这个页面就是成功了，不过现在还无法开始画图，因为还没有下载模型</p></li></ol><h3 id="安装插件">安装插件</h3><p>在正式使用之前我们可以先安装一下中文插件方便阅读</p><ol type="1"><li><p>点击上方Extensions选项卡</p></li><li><p>选择Install from url</p></li><li><p>在URL for extension's git repository中复制下面这串链接</p><pre><code>https://github.com/dtlnor/stable-diffusion-webui-localization-zh_CN.git</code></pre></li><li><p>点击Install，出现以下字样就是成功了</p><p><img src="https://testingcf.jsdelivr.net/gh/nanzhi84/blog-images/202409291411690.png" alt="image-20240929141155643"></p></li><li><p>点击Apply and restart UI重启</p><p><img src="https://testingcf.jsdelivr.net/gh/nanzhi84/blog-images/202409291412066.png" alt="image-20240929141225952"></p></li><li><p>然后去Settings里面找到User Interface找到Localization后把它换成zh_CN再Apply setting后reload ui</p></li><li><p>成功</p><p><img src="https://testingcf.jsdelivr.net/gh/nanzhi84/blog-images/202409291426534.png" alt="image-20240929142604370"></p></li><li><p>(可选)建议去setting里面的文生图附加设置项选上这两个<img src="https://testingcf.jsdelivr.net/gh/nanzhi84/blog-images/202409291505897.png" alt="image-20240929150513782"></p></li></ol><h3 id="准备模型">准备模型</h3><ol type="1"><li><p>先安装基础模型stable-diffusion-v1-5。在autodl-tmp/stable-diffusion-webui/models/Stable-diffusion这个文件夹里打开终端运行以下命令</p><pre class="bash"><code>sudo wget https://huggingface.co/stable-diffusion-v1-5/stable-diffusion-v1-5/resolve/main/v1-5-pruned-emaonly.safetensors</code></pre></li><li><p>然后可以去C站找自己感兴趣的模型，链接https://civitai.com/，里面模型有几种</p><ul><li>Checkpoint：指的是大模型，放在autodl-tmp/stable-diffusion-webui/models/Stable-diffusion文件夹下即可</li><li>LoRA 则是社区开发者微调的小模型，放在autodl-tmp/stable-diffusion-webui/models/Lora</li><li>VAE可以勉强理解为滤镜，对色彩线条有一定影响，放在autodl-tmp/stable-diffusion-webui/models/VAE</li><li>Embedding是对提示词进行打包，放在autodl-tmp/stable-diffusion-webui/embeddings中</li></ul></li></ol><h3 id="实践">实践</h3><p>我们现在来复现一下C站中的一张图片，我选定了下面这张图片<a target="_blank" rel="noopener" href="https://civitai.com/models/317902/t-ponynai3">T-ponynai3 - v6.5 | Stable Diffusion Checkpoint | Civitai</a></p><p><img src="https://testingcf.jsdelivr.net/gh/nanzhi84/blog-images/202409291908453.png" alt="iamge-202409291906385"></p><p><strong>首先安装它要求的T-ponynai3的checkpoints大模型</strong></p><ol type="1"><li><p>我们直接最简单的进入网址下载对应模型到本地<img src="https://testingcf.jsdelivr.net/gh/nanzhi84/blog-images/202409291445798.png" alt="image-20240929144538755"></p></li><li><p>下载好后拖到autodl中对应的文件夹，这里是autodl-tmp/stable-diffusion-webui/models/Stable-diffusion文件夹</p></li><li><p>复制所有图片信息如下</p><p><img src="https://testingcf.jsdelivr.net/gh/nanzhi84/blog-images/202409291519045.png" alt="image-20240929151957993"></p></li><li><p>粘贴到第一个框里并点击下面的箭头会自动设置好</p><p><img src="https://testingcf.jsdelivr.net/gh/nanzhi84/blog-images/202409291521420.png" alt="image-20240929152122324"></p></li><li><p>将对应的模型设置好</p></li><li><p>点击生成</p><p><img src="https://testingcf.jsdelivr.net/gh/nanzhi84/blog-images/202409291525063.png" alt="image-20240929152500862"></p></li><li><p>几乎完美复现了</p><p><img src="https://testingcf.jsdelivr.net/gh/nanzhi84/blog-images/202409291526701.png" alt="image-202409291524492"></p></li></ol><h3 id="reference">Reference</h3><ol type="1"><li><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/yang553566463/article/details/132167437">Ubuntu 20.04 安装 Stable Diffusionn_cannot locate tcmalloc (improves cpu memory usage)-CSDN博客</a></p><p>如果有遇到其它安装环境的问题可以参考这个博客</p></li><li><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/u010522887/article/details/138425635">【保姆级教程】Linux上部署Stable Diffusion WebUI和LoRA训练，拥有你的专属图片生成模型_stable diffusion linux-CSDN博客</a></p></li></ol></div><div id="comment"><div id="waline-container"></div></div></div><footer id="footer"><div id="footer-wrap"><div>&copy; 2024 - 2024 Orion Blog<span id="footer-icon"><i class="fa-solid fa-font-awesome fa-fw"></i></span> &commat;Orion</div><div>Based on the <a target="_blank" rel="noopener" href="https://hexo.io">Hexo Engine</a> &amp; <a target="_blank" rel="noopener" href="https://github.com/theme-particlex/hexo-theme-particlex">ParticleX Theme</a></div></div></footer></div><transition name="fade"><div id="preview" ref="preview" v-show="previewShow"><img id="preview-content" ref="previewContent"></div></transition></div><script src="/js/main.js"></script><script>Waline.init({el:"#waline-container",serverURL:"https://www.orionverse-comment.blog/",commentCount:!0,pageview:!0,emoji:"https://unpkg.com/@waline/emojis@1.0.1/weibo,https://unpkg.com/@waline/emojis@1.0.1/alus,https://unpkg.com/@waline/emojis@1.0.1/bilibili,https://unpkg.com/@waline/emojis@1.0.1/qq,https://unpkg.com/@waline/emojis@1.0.1/tieba,https://unpkg.com/@waline/emojis@1.0.1/tw-emoji".split(","),meta:"nick,mail,link".split(","),requiredMeta:"nick".split(","),lang:"zh-CN",wordLimit:0,pageSize:"10",login:"enable"})</script></body></html>